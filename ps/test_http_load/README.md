# HTTP 負荷テストスクリプト

PowerShell を使用した HTTP エンドポイントの負荷テストツールです。リアルタイムで RPS（Requests Per Second）とレスポンス状況を監視できます。

## 機能

- **並列処理**: 複数のジョブを同時実行してエンドポイントに負荷をかける
- **リアルタイム監視**: 3 秒間隔で RPS、ステータスコード、進捗状況を表示
- **HTTP/1.1 固定**: コネクション再利用による効率的なテスト実行
- **エラーハンドリング**: タイムアウトやネットワークエラーを適切に処理
- **詳細な統計情報**: ステータスコード別の集計とエラー数の表示

## 必要な環境

- Windows PowerShell 5.1 または PowerShell 7.x
- .NET Framework 4.5 以上（HttpClient 使用のため）

## 使用方法

### 基本的な実行

```powershell
# スクリプトを実行
.\test_http_load.ps1
```

### 設定のカスタマイズ

スクリプト内の設定変数を編集して動作をカスタマイズできます：

```powershell
# === 設定 ===
$TargetURL = "http://48.210.196.231"  # テスト対象のURL
$ParallelJobs = 100                   # 並列ジョブ数
$RequestsPerJob = 10000               # 各ジョブあたりのリクエスト数
$TimeoutSec = 3                       # タイムアウト時間（秒）
```

## 設定パラメータの説明

| パラメータ        | 説明                              | 推奨値                             |
| ----------------- | --------------------------------- | ---------------------------------- |
| `$TargetURL`      | テスト対象の URL                  | テスト環境のエンドポイント         |
| `$ParallelJobs`   | 同時実行するジョブ数              | 10-100（サーバー性能に応じて調整） |
| `$RequestsPerJob` | 各ジョブが送信するリクエスト数    | 1000-10000                         |
| `$TimeoutSec`     | HTTP リクエストのタイムアウト時間 | 5 秒以上推奨                       |

## 出力例

```
Starting REAL-TIME RPS test on http://48.210.196.231 with 100 parallel jobs...
Press Ctrl + C to stop.

[Job 1] 3.1 sec | RPS: 32.26 | 100/10000 req | Status 200:95, Errors:5
[Job 2] 3.2 sec | RPS: 31.25 | 100/10000 req | Status 200:100
[Job 3] 3.0 sec | RPS: 33.33 | 100/10000 req | Status 200:98, Status 500:2
...
[Job 1] Finished | Total: 10000 req | Status 200:9950, Errors:50
```

### 出力項目の説明

- **Job ID**: 並列実行しているジョブの識別番号
- **経過時間**: ジョブ開始からの経過時間（秒）
- **RPS**: 現在の Requests Per Second（リクエスト/秒）
- **進捗**: 現在のリクエスト数/総リクエスト数
- **ステータス統計**: HTTP ステータスコード別の集計
- **Errors**: ネットワークエラーやタイムアウトの数

## 実用的な使用例

### 1. 軽い負荷テスト（開発環境）

```powershell
$ParallelJobs = 10
$RequestsPerJob = 1000
$TimeoutSec = 5
```

### 2. 中程度の負荷テスト（ステージング環境）

```powershell
$ParallelJobs = 50
$RequestsPerJob = 5000
$TimeoutSec = 3
```

### 3. 高負荷テスト（本番環境の性能評価）

```powershell
$ParallelJobs = 100
$RequestsPerJob = 10000
$TimeoutSec = 3
```

## 注意事項とベストプラクティス

### ⚠️ 重要な注意事項

1. **テスト環境での実行**: 本番環境での実行は避け、必ずテスト専用環境で実行してください
2. **ネットワーク帯域**: 大量のリクエストを送信するため、ネットワーク帯域に注意してください
3. **サーバーリソース**: 対象サーバーのリソース使用量を監視しながら実行してください

### 📋 ベストプラクティス

1. **段階的な負荷増加**: 小さな負荷から始めて徐々に増加させる
2. **タイムアウト設定**: サーバーの応答時間に応じて適切なタイムアウト値を設定
3. **結果の記録**: テスト結果を記録して性能改善の参考にする
4. **停止方法**: 異常を検知した場合は`Ctrl + C`で即座に停止

## トラブルシューティング

### よくある問題と解決方法

| 問題                   | 原因                       | 解決方法                                |
| ---------------------- | -------------------------- | --------------------------------------- |
| 大量のエラーが発生     | タイムアウト時間が短すぎる | `$TimeoutSec`を 5 秒以上に設定          |
| RPS が低い             | 並列数が少ない             | `$ParallelJobs`を増加（ただし段階的に） |
| スクリプトが停止しない | 無限ループ状態             | `Ctrl + C`で強制終了                    |

### パフォーマンス調整のヒント

- **CPU 使用率**: 100%に近い場合は並列数を減らす
- **メモリ使用量**: 急激に増加する場合はリクエスト数を調整
- **ネットワーク使用率**: 帯域制限に達している場合は負荷を軽減

## ライセンス

このスクリプトは個人的な学習・テスト目的での使用を想定しています。商用利用や第三者のシステムへの使用は適切な許可を得てから行ってください。

## 貢献

バグ報告や機能改善の提案は、GitHub の Issue または Pull Request でお知らせください。

---

**免責事項**: このツールを使用することで発生するいかなる損害についても、作成者は責任を負いません。自己責任でご利用ください。
